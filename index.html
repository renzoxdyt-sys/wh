<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Wehold — Inversión directa en compañías</title>
  <meta name="description" content="Wehold — Accede a participaciones reales en empresas con transparencia, liquidez y comisiones alineadas a resultados." />

  <!-- Montserrat (Light 300, Medium 500, Bold 700) -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet">

  <!-- GSAP + ScrollTrigger + Lenis (CDN) -->
  <script src="https://unpkg.com/gsap@3.12.2/dist/gsap.min.js"></script>
  <script src="https://unpkg.com/gsap@3.12.2/dist/ScrollTrigger.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@studio-freight/lenis@1.0.31/bundled/lenis.min.js"></script>

  <style>
    /* Brand palette */
    :root{
      --burgundy: #7A1523; /* borgoña */
      --midnight: #0A1F44; /* midnight blue */
      --bluesteel: #B0B7C3;
      --white: #FFFFFF;
      --black: #000000;
      --wehold-gold: #D4AF37;

      --container:1180px;
      --ease:cubic-bezier(.2,.9,.2,1);
    }

    *{box-sizing:border-box}
    html,body,#root{height:100%}
    body{
      margin:0;
      font-family:'Montserrat', system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
      background:var(--white);
      color:var(--midnight);
      -webkit-font-smoothing:antialiased;
      transition:background .45s var(--ease), color .45s var(--ease);
      -webkit-font-smoothing:antialiased;
    }
    a{text-decoration:none;color:inherit}

    .site{min-height:100vh;display:flex;flex-direction:column;overflow:hidden}

    /* Header */
    header{position:fixed;left:0;right:0;top:0;height:72px;display:flex;align-items:center;z-index:160;padding:0 20px;background:transparent}
    .nav{max-width:var(--container);margin:0 auto;width:100%;display:flex;align-items:center;justify-content:space-between}
    .logo{display:flex;align-items:center;gap:12px}
    .logo-text{font-weight:700;font-family:'Montserrat',sans-serif;color:var(--burgundy);font-size:22px;letter-spacing:0.2px}
    nav ul{display:flex;gap:22px;list-style:none;margin:0;padding:0;align-items:center}
    nav a{font-weight:500;font-size:15px;color:var(--midnight);opacity:.95;padding:8px 12px;border-radius:8px}
    nav a:hover{color:var(--burgundy)}
    .actions{display:flex;gap:12px;align-items:center}
    .btn{padding:10px 14px;border-radius:10px;border:1px solid rgba(10,31,68,0.06);background:transparent;cursor:pointer;font-weight:700}
    .btn.primary{background:linear-gradient(90deg,var(--burgundy),var(--midnight));color:var(--white);border:none;box-shadow:0 12px 30px rgba(122,21,35,0.08)}

    /* MAIN */
    main{flex:1;margin-top:116px; /* space for header + ticker */ min-height:calc(100vh - 116px);overflow-y:auto;scroll-behavior:smooth}
    section{min-height:100vh;display:flex;align-items:center;padding:100px 24px}
    .container{max-width:var(--container);margin:0 auto;width:100%}

    /* Hero */
    .eyebrow{font-size:13px;color:var(--midnight);text-transform:uppercase;letter-spacing:1.2px;margin-bottom:14px;font-weight:500}
    .hero h1{font-size:64px;line-height:1.02;margin:0 0 18px;font-weight:700;color:var(--midnight)}
    .lead{max-width:62ch;font-size:18px;color:var(--bluesteel);margin-bottom:26px;font-weight:300}
    .hero-grid{display:grid;grid-template-columns:1fr 420px;gap:48px;align-items:center}
    .visual-card{border-radius:18px;padding:18px;background:linear-gradient(180deg,rgba(122,21,35,0.04),rgba(10,31,68,0.02));box-shadow:0 20px 40px rgba(10,31,68,0.06)}

    /* Features */
    .features-row{display:flex;gap:18px;align-items:stretch}
    .feature{flex:1;padding:22px;border-radius:12px;background:linear-gradient(180deg,#fff,#fbfcff);border:1px solid rgba(10,31,68,0.04);transition:transform .28s var(--ease),box-shadow .28s var(--ease)}
    .feature:hover{transform:translateY(-6px);box-shadow:0 24px 40px rgba(10,31,68,0.06)}
    .feature h4{margin:0 0 8px;color:var(--midnight);font-weight:700}
    .feature p{margin:0;color:var(--bluesteel);font-weight:300}

    /* How */
    section#how { color: var(--midnight); }
    .how .track{display:flex;gap:18px}
    .step{flex:1;padding:20px;border-radius:12px;background:linear-gradient(180deg,#fff,#fbfcff);box-shadow:0 10px 30px rgba(10,31,68,0.04);text-align:center}
    .step .num{width:48px;height:48px;border-radius:10px;background:linear-gradient(90deg,var(--burgundy),var(--midnight));display:inline-flex;align-items:center;justify-content:center;color:var(--white);font-weight:800;margin-bottom:12px}

    /* Philosophy */
    #philosophy h4{margin-top:0;font-weight:700}
    #philosophy p{color:var(--bluesteel);font-weight:300}

    /* Metrics */
    .metric{flex:1;padding:18px;border-radius:12px;color:var(--white);background:linear-gradient(180deg,var(--midnight),rgba(10,31,68,0.85));text-align:center}
    .metric .big{font-size:28px;font-weight:700}
    .metric .label{font-size:13px;color:var(--bluesteel);margin-top:6px;font-weight:300}

    /* Team */
    .team .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
    .member{padding:12px;border-radius:12px;background:linear-gradient(180deg,#fff,#fbfcff);display:flex;gap:12px;align-items:center}
    .avatar{width:64px;height:64px;border-radius:10px;background:linear-gradient(180deg,var(--bluesteel),#eef3fb);}

    .cta-band{margin:48px auto;padding:32px;border-radius:16px;display:flex;justify-content:space-between;align-items:center;gap:16px;background:linear-gradient(90deg,var(--burgundy),var(--midnight));color:var(--white)}

    .reveal{opacity:0;transform:translateY(10px);transition:opacity .6s var(--ease),transform .6s var(--ease)}
    .reveal.show{opacity:1;transform:none}

    footer{padding:28px 24px;border-top:1px solid rgba(10,31,68,0.04)}
    footer small{color:var(--bluesteel)}

    @media (max-width:980px){.hero-grid{grid-template-columns:1fr}nav ul{display:none}}
    @media (max-width:520px){
      .hero h1{font-size:34px}
      .team .grid{grid-template-columns:1fr}
      .features-row{overflow-x:auto;scroll-snap-type:x mandatory;padding-bottom:8px}
      .feature{min-width:260px;scroll-snap-align:center}
      .cta-band{flex-direction:column;text-align:center}
      .team .grid{grid-template-columns:repeat(2,1fr)}
    }
    @media (prefers-reduced-motion: reduce){.reveal{transition:none;opacity:1;transform:none}body{transition:none}}
  </style>

  <!-- TICKER styles (borgoña + wehold gold) -->
  <style>
    :root{ --wehold-gold: #D4AF37; }
    .ticker-wrap{
      position:sticky;
      top:72px;
      z-index:150;
      background: var(--burgundy);
      overflow:hidden;
      height:44px;
      display:flex;
      align-items:center;
      padding-left:8px;
      border-top:1px solid rgba(255,255,255,0.06);
      border-bottom:1px solid rgba(255,255,255,0.06);
    }
    .ticker {
      display:flex;
      align-items:center;
      white-space:nowrap;
      will-change:transform;
    }
    .ticker-item {
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:0 16px;
      font-weight:500;
      color: #ffffff;
      font-size:14px;
      border-left:1px solid rgba(255,255,255,0.06);
    }
    .ticker-item .symbol { font-weight:700; color: #ffffff; margin-right:8px; font-size:13px; }
    .ticker-item .price { min-width:80px; text-align:right; font-weight:700; }
    .ticker-item .chg { margin-left:10px; min-width:64px; text-align:right; display:flex; align-items:center; gap:6px; justify-content:flex-end; }
    .chg .arrow{font-size:12px;}
    .chg.up { color:#1fb97a; }
    .chg.flat { color:#cbd5e1; }
    .chg.down { color:#ff6b6b; }

    .ticker-item.wehold { color: var(--wehold-gold); }
    .ticker-item.wehold .symbol { color: var(--wehold-gold); font-weight:800; letter-spacing:0.6px; }
    .ticker-item.wehold .price { color: var(--white); background: rgba(255,255,255,0.06); padding:6px 10px; border-radius:8px; font-weight:800; }

    @keyframes ticker-scroll { from { transform: translateX(0); } to { transform: translateX(calc(var(--scrollWidth) * -1)); } }

    @media (max-width:640px){
      .ticker-wrap{height:36px}
      .ticker-item{padding:0 10px;font-size:13px}
      .ticker-item .price{min-width:64px}
    }
  </style>
</head>
<body>
  <div class="site">
    <header id="site-header">
      <div class="nav">
        <div class="logo">
          <div class="logo-text" aria-label="Wehold">Wehold.</div>
        </div>

        <nav>
          <ul>
            <li><a href="#home">Inicio</a></li>
            <li><a href="#how">Cómo funciona</a></li>
            <li><a href="#philosophy">Filosofía</a></li>
            <li><a href="#strategy">Números</a></li>
            <li><a href="#team">Equipo</a></li>
            <li><a href="#letters">Cartas</a></li>
          </ul>
        </nav>

        <div class="actions">
          <!-- Portfolio widget placed here -->
          <div id="portfolioWidget" style="margin-right:8px;display:flex;align-items:center;">
            <div style="display:flex;align-items:center;gap:10px">
              <div style="font-size:12px;color:var(--bluesteel);font-weight:300">Cartera</div>
              <div style="background:linear-gradient(180deg,#fff,#fbfcff);padding:8px 12px;border-radius:10px;border:1px solid rgba(10,31,68,0.04);display:flex;gap:10px;align-items:center">
                <div style="font-weight:700;color:var(--midnight)" id="nav-value">Cargando...</div>
                <div id="nav-pct" style="font-weight:700;color:var(--bluesteel)">—</div>
              </div>
            </div>
          </div>

          <button class="btn" id="btn-demo">Solicitar demo</button>
          <button class="btn primary" id="btn-start">Empieza hoy</button>
        </div>
      </div>
    </header>

    <!-- TICKER BAR -->
    <div class="ticker-wrap" aria-hidden="false">
      <div id="ticker" class="ticker" role="list" aria-label="Market ticker"></div>
    </div>

    <main id="main-scroll">
      <!-- HERO -->
      <section id="home" data-bg="#ffffff" data-contrast="light">
        <div class="container hero-grid">
          <div>
            <div class="eyebrow reveal">Wehold · Inversión directa</div>
            <h1 class="reveal">Invirtiendo distinto.<br>Creando valor real.</h1>
            <p class="lead reveal">Liquidez inmediata. Accionista directo. Comisiones alineadas a resultados. Transparencia en cada paso.</p>
            <div class="hero-cta reveal" style="display:flex;gap:12px;align-items:center">
              <button class="btn primary" id="hero-primary">Empieza hoy</button>
              <button class="btn" id="hero-secondary">Cómo funciona</button>
            </div>
            <div class="subtle reveal" style="margin-top:12px;color:var(--bluesteel);font-weight:300">Invertir implica riesgo. <a href="#legal">Lee nuestros términos</a>.</div>
          </div>

          <div class="visual-card reveal" aria-hidden>
            <div style="height:320px;border-radius:12px;background:linear-gradient(180deg,#fff,#f6fbff);display:flex;align-items:center;justify-content:center;border:1px solid rgba(10,31,68,0.04)">
              <svg width="320" height="200" viewBox="0 0 320 200" xmlns="http://www.w3.org/2000/svg" aria-hidden>
                <rect width="320" height="200" rx="12" fill="url(#g)" stroke="rgba(10,31,68,0.04)"/>
                <path id="spark" d="M18 150 L60 110 L110 120 L160 80 L210 100 L260 60 L300 90" stroke="#7A1523" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#ffffff"/><stop offset="1" stop-color="#f5fbff"/></linearGradient></defs>
              </svg>
            </div>
          </div>
        </div>
      </section>

      <!-- FEATURES -->
      <section id="features" data-bg="#f7fbff" data-contrast="light">
        <div class="container">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:18px">
            <h3 class="reveal">Por qué Wehold</h3>
          </div>

          <div class="features-row">
            <div class="feature reveal"><h4>Equity directo</h4><p>Tu capital participa en compañías reales —sin intermediarios que diluyan incentivos.</p></div>
            <div class="feature reveal"><h4>Liquidez controlada</h4><p>Mecanismos que te permiten salida sin esperar cierres largos de fondo.</p></div>
            <div class="feature reveal"><h4>Modelo alineado</h4><p>Cobramos por rendimiento —si y sólo si entregamos valor a tus inversiones.</p></div>
          </div>
        </div>
      </section>

      <!-- HOW -->
      <section id="how" data-bg="#f8fafc" data-contrast="light">
        <div class="container">
          <h3 class="reveal">Cómo funciona</h3>
          <div class="how">
            <div class="track" style="display:flex;gap:18px;margin-top:18px">
              <div class="step reveal">
                <div class="num">1</div>
                <h5 style="margin:8px 0">Abrir cuenta</h5>
                <p>Registro rápido con verificación segura.</p>
              </div>

              <div class="step reveal">
                <div class="num">2</div>
                <h5 style="margin:8px 0">Seleccionar</h5>
                <p>Oportunidades curadas por nuestro equipo de inversión.</p>
              </div>

              <div class="step reveal">
                <div class="num">3</div>
                <h5 style="margin:8px 0">Invertir</h5>
                <p>Transparencia, seguimiento y opciones de liquidez.</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- PHILOSOPHY / STRATEGY -->
      <section id="philosophy" data-bg="#f8fafc" data-contrast="light">
        <div class="container">
          <h3 class="reveal">Nuestra filosofía y estrategia</h3>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-top:18px;align-items:start">
            <div class="reveal">
              <h4>Misión</h4>
              <p>Invertir en compañías con potencial real de crecimiento y promover una relación directa entre capitalistas y empresas, reduciendo intermediarios y alineando incentivos.</p>
            </div>
            <div class="reveal">
              <h4>Estrategia</h4>
              <p>Seleccionamos oportunidades mediante análisis fundamental riguroso, acompañamiento operativo y estructuras que permiten liquidez controlada. Priorizamos compañías con ventajas competitivas claras y equipos fundadores comprometidos.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- NUMBERS / METRICS -->
      <section id="strategy" data-bg="#f8fafc" data-contrast="light">
        <div class="container">
          <div style="display:flex;gap:16px;align-items:stretch">
            <div class="metric reveal" style="flex:1;">
              <div class="big">S/ 500,000+</div>
              <div class="label">Activos administrados (AUM)</div>
            </div>

            <div class="metric reveal" style="flex:1;">
              <div class="big">+10</div>
              <div class="label">Clientes</div>
            </div>

            <div class="metric reveal" style="flex:1;">
              <div class="big">20%</div>
              <div class="label">Rendimiento (hasta 15 de septiembre de 2025)</div>
            </div>
          </div>
        </div>
      </section>

      <!-- TEAM -->
      <section id="team" data-bg="#ffffff" data-contrast="light">
        <div class="container">
          <h3 class="reveal" style="text-align:center;margin-bottom:18px">Equipo</h3>
          <div class="team">
            <div class="grid">
              <div class="member reveal"><div class="avatar"></div><div><strong>Renzo Franco</strong><div style="color:var(--bluesteel);font-size:13px">CEO & Fundador</div></div></div>
              <div class="member reveal"><div class="avatar"></div><div><strong>María Pérez</strong><div style="color:var(--bluesteel);font-size:13px">Head Inversiones</div></div></div>
              <div class="member reveal"><div class="avatar"></div><div><strong>Carlos Ruiz</strong><div style="color:var(--bluesteel);font-size:13px">Ops & Compliance</div></div></div>
              <div class="member reveal"><div class="avatar"></div><div><strong>Luisa Gómez</strong><div style="color:var(--bluesteel);font-size:13px">Marketing</div></div></div>
            </div>
          </div>
        </div>
      </section>

      <!-- LETTERS (at the end) -->
      <section id="letters" data-bg="#ffffff" data-contrast="light">
        <div class="container">
          <h3 class="reveal">Cartas trimestrales</h3>

          <div id="admin-upload" style="margin:16px 0;">
            <input id="fileInput" type="file" accept="application/pdf" />
            <input id="titleInput" placeholder="Título (ej: Carta Q1 2025)" style="margin-left:8px" />
            <input id="quarterInput" placeholder="Trimestre (ej: Q1 2025)" style="margin-left:8px" />
            <button id="uploadBtn" class="btn">Subir</button>
            <small id="uploadMsg" style="display:block;color:var(--bluesteel);margin-top:8px"></small>
          </div>

          <div id="lettersList"></div>
        </div>
      </section>

      <section id="cta" data-bg="#0A1F44" data-contrast="dark">
        <div class="container cta-band" style="border-radius:12px">
          <h3 style="margin:0;color:var(--white)">Tu inversión, siempre disponible. Hazla crecer con Wehold.</h3>
          <div>
            <button class="btn" id="band-contact">Solicitar contacto</button>
            <button class="btn primary" id="band-start">Empieza hoy</button>
          </div>
        </div>
      </section>

    </main>

    <footer>
      <div style="max-width:var(--container);margin:0 auto;display:flex;justify-content:space-between;align-items:center">
        <small style="color:var(--bluesteel)">&copy; <span id="year"></span> Wehold • Invertir implica riesgo.</small>
        <div style="display:flex;gap:14px;align-items:center"><a href="#legal">Términos</a><a href="mailto:contacto@wehold.com">contacto@wehold.com</a></div>
      </div>
    </footer>
  </div>

  <!-- Modal contacto -->
  <div id="modal" aria-hidden style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:24px;visibility:hidden">
    <div id="backdrop" style="position:absolute;inset:0;background:rgba(10,12,20,0.45)"></div>
    <div style="position:relative;z-index:90;background:var(--white);border-radius:14px;padding:22px;max-width:640px;width:100%">
      <button id="close" style="position:absolute;right:12px;top:12px;border:0;background:transparent;font-size:18px;cursor:pointer">✕</button>
      <h4>Solicitar contacto</h4>
      <form id="form" style="display:flex;flex-direction:column;gap:12px;margin-top:8px">
        <input name="name" placeholder="Nombre" required style="padding:12px;border-radius:10px;border:1px solid #e6edf3">
        <input name="email" placeholder="Email" type="email" required style="padding:12px;border-radius:10px;border:1px solid #e6edf3">
        <input name="phone" placeholder="Teléfono (opcional)" style="padding:12px;border-radius:10px;border:1px solid #e6edf3">
        <textarea name="msg" rows="3" placeholder="Mensaje (opcional)" style="padding:12px;border-radius:10px;border:1px solid #e6edf3"></textarea>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button type="button" class="btn" id="cancel">Cancelar</button>
          <button type="submit" class="btn primary">Enviar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script>
    // small init
    document.getElementById('year').textContent = new Date().getFullYear();

    // GSAP + ScrollTrigger
    if(typeof gsap !== 'undefined' && typeof ScrollTrigger !== 'undefined') gsap.registerPlugin(ScrollTrigger);

    // Safe Lenis init (avoid "Lenis is not defined" errors)
    let lenis, usingLenis = false;
    function initScrolling(){
      try{
        if(typeof Lenis !== 'undefined'){
          lenis = new Lenis({ duration:1.1, easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)), smooth:true, direction:'vertical' });
          function raf(t){ lenis.raf(t); requestAnimationFrame(raf); }
          requestAnimationFrame(raf);

          if(typeof ScrollTrigger !== 'undefined'){
            ScrollTrigger.scrollerProxy(window, {
              scrollTop(value){ if(arguments.length){ lenis.scrollTo(value); return; } return window.scrollY; },
              getBoundingClientRect(){ return {top:0,left:0,width:window.innerWidth,height:window.innerHeight}; },
              pinType: document.body.style.transform ? 'transform' : 'fixed'
            });
            lenis.on('scroll', ScrollTrigger.update);
            usingLenis = true;
          }
        }
      }catch(e){
        console.warn('Lenis init skipped', e);
        usingLenis = false;
      }
      if(!usingLenis) window.addEventListener('scroll', ()=> {});
      setTimeout(()=>{ if(typeof ScrollTrigger !== 'undefined') ScrollTrigger.refresh(); }, 120);
    }
    initScrolling();

    // reveal animations with fallback
    try{
      document.querySelectorAll('.reveal').forEach(el=>{
        gsap.fromTo(el, {y:18, autoAlpha:0}, {y:0, autoAlpha:1, duration:0.7, ease:'power3.out', scrollTrigger:{trigger:el, start:'top 80%'}});
      });
    }catch(e){
      document.querySelectorAll('.reveal').forEach(el=>el.classList.add('show'));
    }

    // Letters mock
    async function fetchList(){
      const mock = [
        { key: 'quarterly/carta-q2-2025.pdf', title: 'Carta Q2 2025', quarter: 'Q2 2025' },
        { key: 'quarterly/carta-q1-2025.pdf', title: 'Carta Q1 2025', quarter: 'Q1 2025' }
      ];
      const container = document.getElementById('lettersList');
      container.innerHTML = mock.map(item=>`<div class="item"><strong>${item.title}</strong> — <small>${item.quarter}</small><div style="margin-top:6px"><a href="#">Descargar PDF</a></div></div>`).join('');
    }
    fetchList();

    // Upload mock
    document.getElementById('uploadBtn').addEventListener('click', async ()=>{
      const file = document.getElementById('fileInput').files[0];
      const title = document.getElementById('titleInput').value.trim();
      const quarter = document.getElementById('quarterInput').value.trim();
      const msg = document.getElementById('uploadMsg'); msg.textContent='';
      if(!file){ msg.textContent='Selecciona un PDF.'; return; }
      if(file.size > 10 * 1024 * 1024){ msg.textContent='Archivo demasiado grande (>10MB).'; return; }
      if(!title || !quarter){ msg.textContent='Completa título y trimestre.'; return; }
      msg.textContent = 'Simulación: archivo subido correctamente.';
      setTimeout(()=>{ msg.textContent=''; fetchList(); }, 800);
    });

    // modal
    (function modalSetup(){
      const modal = document.getElementById('modal');
      const openBtns = document.querySelectorAll('#btn-demo,#btn-start,#hero-primary,#band-contact,#band-start');
      const closeBtn = document.getElementById('close');
      const cancel = document.getElementById('cancel');
      openBtns.forEach(b=>b.addEventListener('click', ()=>{ modal.style.visibility='visible'; modal.setAttribute('aria-hidden','false'); }));
      function closeModal(){ modal.style.visibility='hidden'; modal.setAttribute('aria-hidden','true'); }
      closeBtn && closeBtn.addEventListener('click', closeModal);
      cancel && cancel.addEventListener('click', closeModal);
      document.getElementById('backdrop') && document.getElementById('backdrop').addEventListener('click', closeModal);
      const form = document.getElementById('form'); form && form.addEventListener('submit',(e)=>{ e.preventDefault(); alert('Gracias — recibimos tu solicitud.'); closeModal(); });
    })();
  </script>

  <!-- TICKER client + portfolio widget (poll 15s) -->
  <script>
  (function(){
    // Ticker
    const T = document.getElementById('ticker');
    const POLL_INTERVAL = 15000; // 15s
    const SPEED_PX_PER_SEC = 60;
    let poller = null;

    function createItem(label, price, changePct, isWehold=false) {
      const item = document.createElement('div');
      item.className = 'ticker-item' + (isWehold ? ' wehold' : '');
      const priceText = (price === null || price === undefined) ? '—' : Number(price).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
      const change = (changePct === null || changePct === undefined) ? null : Number(changePct);
      let chClass = 'flat';
      let arrow = '→';
      if (change !== null) {
        if (change > 0.01) { chClass = 'up'; arrow = '▲'; }
        else if (change < -0.01) { chClass = 'down'; arrow = '▼'; }
        else { chClass = 'flat'; arrow = '→'; }
      }
      item.innerHTML = `<span class="symbol">${label}</span><span class="price">${priceText}</span><span class="chg ${chClass}"><span class="arrow">${arrow}</span><span class="pct">${change !== null ? (change > 0 ? '+' : '') + change + '%' : ''}</span></span>`;
      return item;
    }

    function buildAndAnimate(items) {
      T.style.animation = 'none';
      T.innerHTML = '';
      const frag = document.createDocumentFragment();
      items.forEach(it => frag.appendChild(createItem(it.label, it.price, it.changePct, it.isWehold)));
      const fragClone = frag.cloneNode(true);
      T.appendChild(frag);
      T.appendChild(fragClone);
      requestAnimationFrame(()=> {
        const totalWidth = T.scrollWidth;
        const half = totalWidth / 2;
        if (!half || half === Infinity) return;
        T.style.setProperty('--scrollWidth', half + 'px');
        const duration = Math.max(12, Math.round(half / SPEED_PX_PER_SEC));
        void T.offsetWidth;
        T.style.animation = `ticker-scroll ${duration}s linear infinite`;
      });
    }

    async function fetchAndRender() {
      try {
        const [qRes, pRes] = await Promise.all([
          fetch('/api/quotes').then(r => r.ok ? r.json() : Promise.reject('quotes fail')).catch(()=>null),
          fetch('/api/portfolio').then(r => r.ok ? r.json() : null).catch(()=>null)
        ]);
        const quotes = (qRes && qRes.results) ? qRes.results : [];
        const items = [];

        if (pRes && pRes.portfolioIndex) {
          items.push({ label: 'Wehold', price: pRes.portfolioIndex, changePct: pRes.dailyChangePct, isWehold: true });
          // update header widget
          const navEl = document.getElementById('nav-value');
          const pctEl = document.getElementById('nav-pct');
          if(navEl) navEl.textContent = pRes.nav ? `S/ ${pRes.nav.toLocaleString()}` : '—';
          if(pctEl) {
            if(pRes.dailyChangePct !== null) {
              const up = pRes.dailyChangePct > 0;
              pctEl.textContent = `${up ? '▲' : pRes.dailyChangePct < 0 ? '▼' : '→'} ${pRes.dailyChangePct}%`;
              pctEl.style.color = up ? '#1fb97a' : pRes.dailyChangePct < 0 ? '#ff6b6b' : '#cbd5e1';
            } else {
              pctEl.textContent = '—';
              pctEl.style.color = 'var(--bluesteel)';
            }
          }
        }

        quotes.forEach(q => {
          items.push({ label: q.label, price: q.price, changePct: q.changePct, isWehold: false });
        });

        // ensure we have items; fallback if empty
        if (items.length === 0) {
          items.push({ label: 'Wehold', price: 1000.00, changePct: 0.00, isWehold: true });
          items.push({ label: 'S&P 500', price: 4500.12, changePct: 0.34 });
        }

        buildAndAnimate(items);
      } catch (err) {
        console.warn('Ticker error', err);
        const mock = [
          { label: 'Wehold', price: 1000.00, changePct: 0.12, isWehold: true },
          { label: 'S&P 500', price: 4500.12, changePct: 0.34 },
          { label: 'Dow Jones', price: 35000.12, changePct: -0.12 },
          { label: 'Nasdaq', price: 14000.12, changePct: 0.52 },
          { label: 'BTC', price: 42000.12, changePct: -1.35 }
        ];
        buildAndAnimate(mock);
      }
    }

    fetchAndRender();
    poller = setInterval(fetchAndRender, POLL_INTERVAL);

    window.addEventListener('beforeunload', ()=> clearInterval(poller));
    window.addEventListener('resize', ()=> {
      if (typeof window._tickerResizeTO !== 'undefined') clearTimeout(window._tickerResizeTO);
      window._tickerResizeTO = setTimeout(()=> fetchAndRender(), 250);
    });

  })();
  </script>
</body>
</html>
